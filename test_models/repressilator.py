#!/usr/bin/env python

import numpy as np
from scipy.integrate import odeint

repressilator_bounds = [(0.0001, 3), (0, 3), (0.0001, 300), (1, 3)]


def repressilator(k):

    time = [0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0,
            12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0, 20.0, 21.0, 22.0,
            23.0, 24.0, 25.0, 26.0, 27.0, 28.0, 29.0, 30.0]
    data = [[0.0, 4.488846434366473, 2.714549849482517, 6.444232842805658,
            24.46915418051586, 28.10847096509343, 12.352648374738962,
            4.642084698577026, 1.7680776143463963, 1.021496030595813,
            3.267806870812699, 20.929580826244084, 78.3339386191075,
            100.7436161294691, 47.79012929059134, 17.941099072860265,
            6.617110586145705, 2.4440268086718504, 0.951563472874828,
            0.7644717392379156, 3.5650512822218166, 23.478296974713917,
            87.23136259723577, 128.32521206660542, 69.30940166807454,
            26.37789572418784, 9.734102510989835, 3.5877278085642805,
            1.341496339018698, 0.6566841899282982, 1.5514740612906064],
            [0.0, 7.742061201862163, 14.391088537157326, 16.974296844695527,
            7.899954410672454, 3.069399974996809, 1.4354765740337925,
            2.6773119148949496, 15.941754369100247, 63.10289659169389,
            75.72477982893746, 34.0520319646856, 12.7289107612553,
            4.696629202852429, 1.7465995092492885, 0.7699829065751013,
            1.3012974418730994, 8.258355474482642, 45.87172051258875,
            115.03319324718298, 103.88397198459698, 43.774965755726306,
            16.26789221889942, 5.995229700373173, 2.2150455948615915,
            0.872025466380766, 0.7757453858288323, 3.883609594481504,
            25.34784699509665, 90.8747629049713, 129.33441542341896],
            [0.0, 15.377957596058963, 7.271258542143068, 3.130204124770662,
            1.9680627901714662, 5.88349037388796, 29.67982713087371,
            54.460354064814375, 28.46895977886859, 10.807796228922934,
            3.9986584694811, 1.507968306741181, 0.8159479616352445,
            2.373231728111996, 15.757634891245326, 69.26229678427654,
            120.1993554217916, 71.53867088006662, 27.56348971165622,
            10.18036554609494, 3.7524367255334536, 1.4013420739082287,
            0.6712101030917313, 1.496285727399844, 9.97675873270304,
            52.53481181917566, 121.78229638959401, 103.36679024093779,
            42.84595626728656, 15.902563870945832, 5.860016651007407],
            [5.0, 3.7838452971716685, 2.7474664897608516, 8.301575599628254,
            28.947584598674258, 25.013238712836074, 9.9924721357968,
            3.726366255890754, 1.446840734155867, 1.054385536657148,
            4.457314954597095, 28.137201041233915, 91.43846811458191,
            93.2188752686717, 38.7803561106884, 14.370017414630524,
            5.296162462028342, 1.9600077860482445, 0.7946386996400134,
            0.8795461071715619, 4.944394318921207, 31.499164170332946,
            102.28991056938025, 124.50395812364114, 56.795321112621046,
            21.13964698165305, 7.790239451169012, 2.8726041530697364,
            1.0865219442970149, 0.6307944930344132, 2.0848918689606855],
            [0.0, 7.862347076990986, 16.621041722916388, 15.393063602753598,
            6.443103590060988, 2.495836230065179, 1.330784634849836,
            3.507181780947691, 21.549868725965723, 73.98225839463343,
            68.39234852399709, 27.540315326699634, 10.1942538423991,
            3.76029412985095, 1.4080468655473872, 0.6979691371526444,
            1.6975358084630652, 11.440580249938984, 58.55466038674178,
            125.37615593859023, 90.63257642471467, 35.26543063698353,
            13.0232526301014, 4.798156416258913, 1.777066339706983,
            0.7341923658523394, 0.9148179382167453, 5.395779231869185,
            33.87282378972335, 105.89835094407697, 124.64292696753931],
            [15.0, 13.19508896774686, 6.089957927605723, 2.623252877978745,
            2.043504673077439, 7.871507322911047, 37.40757267760475,
            52.64984146642906, 23.2622883707938, 8.664377770258772,
            3.204126405040172, 1.2281613471574242, 0.8209470359420186,
            3.2274735892153115, 21.484132877498908, 83.8154464725227,
            120.34043619689287, 59.11277660705078, 22.10306981303201,
            8.147819943670633, 3.0043938453519865, 1.133834734169324,
            0.6375264866255466, 2.001979323134851, 13.786923392575122,
            66.1986210559441, 131.06571578133176, 89.35344838736052,
            34.48545842054846, 12.729978045976193, 4.689921055534799]]

    def repressilator_model(y, t):

        dy0 = 5 * y[3] - 5 * y[0]
        dy1 = 5 * y[4] - 5 * y[1]
        dy2 = 5 * y[5] - 5 * y[2]

        dy3 = k[1] + k[2] / (1 + y[2] ** k[3]) - k[0] * y[3]
        dy4 = k[1] + k[2] / (1 + y[0] ** k[3]) - k[0] * y[4]
        dy5 = k[1] + k[2] / (1 + y[1] ** k[3]) - k[0] * y[5]

        return [dy0, dy1, dy2, dy3, dy4, dy5]

    init = np.array([0.0, 0.0, 0.0, 5.0, 0.0, 15.0])
    simulation = odeint(repressilator_model, init, time)

    return sum([sum((simulation[:, i] - data[i]) ** 2)
                for i in range(len(data))])
